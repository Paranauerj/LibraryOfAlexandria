!function(){function t(n,e){return e?require(n):n.slice?t[o(n)]:function(e,i){n(e={exports:{}}),t[o(i)]=e.exports};function o(t){return t.split("/").slice(-1).toString().replace(".js","")}}if("undefined"!=typeof module)var n=module;t(function(t){var n={};n.fn={is:function(t){return!!t&&"function"==typeof t}},n.bi={is:function(t){return t instanceof Boolean||"boolean"==typeof t}},n.num={is:function(t){return!e(t)&&(t-parseFloat(t)+1>=0||1/0===t||-1/0===t)}},n.text={is:function(t){return"string"==typeof t}},n.text.ify=function(t){return n.text.is(t)?t:"undefined"!=typeof JSON?JSON.stringify(t):t&&t.toString?t.toString():t},n.text.random=function(t,n){var e="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";t>0;)e+=n.charAt(Math.floor(Math.random()*n.length)),t--;return e},n.text.match=function(t,n){var e,o;return"string"==typeof t&&("string"==typeof n&&(n={"=":n}),t===(e=(n=n||{})["="]||n["*"]||n[">"]||n["<"])||o===n["="]&&(e=n["*"]||n[">"]||n["<"],t.slice(0,(e||"").length)===e||o===n["*"]&&(o!==n[">"]&&o!==n["<"]?t>=n[">"]&&t<=n["<"]:o!==n[">"]&&!!(t>=n[">"])||o!==n["<"]&&!!(t<=n["<"]))))},n.text.hash=function(t,n){if("string"==typeof t){if(n=n||0,!t.length)return n;for(var e,o=0,i=t.length;o<i;++o)n=(n<<5)-n+(e=t.charCodeAt(o)),n|=0;return n}},n.list={is:function(t){return t instanceof Array}},n.list.slit=Array.prototype.slice,n.list.sort=function(t){return function(n,e){return n&&e?(n=n[t])<(e=e[t])?-1:n>e?1:0:0}},n.list.map=function(t,n,e){return a(t,n,e)},n.list.index=1,n.obj={is:function(t){return!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},n.obj.put=function(t,n,e){return(t||{})[n]=e,t},n.obj.has=function(t,n){return t&&Object.prototype.hasOwnProperty.call(t,n)},n.obj.del=function(t,n){if(t)return t[n]=null,delete t[n],t},n.obj.as=function(t,n,e,o){return t[n]=t[n]||(o===e?{}:e)},n.obj.ify=function(t){if(i(t))return t;try{t=JSON.parse(t)}catch(n){t={}}return t},function(){var t;function e(n,e){(!r(this,e)||t===this[e])&&(this[e]=n)}n.obj.to=function(t,n){return a(t,e,n=n||{}),n}}(),n.obj.copy=function(t){return t?JSON.parse(JSON.stringify(t)):t},function(){function t(t,n){var e,o=this.n;if(!(o&&(n===o||i(o)&&r(o,n)))&&e!==n)return!0}n.obj.empty=function(n,e){return!n||!a(n,t,{n:e})}}(),function(){function t(n,e){if(2===arguments.length){t.r=t.r||{},t.r[n]=e;return}t.r=t.r||[],t.r.push(n)}var o,a=Object.keys;Object.keys=Object.keys||function(t){return o(t,function(t,n,e){e(n)})},n.obj.map=o=function(o,u,s){var f,c,l,p,h,d=0,g="function"==typeof u;if(t.r=f,a&&i(o)&&(p=a(o),h=!0),s=s||{},e(o)||p)for(c=(p||o).length;d<c;d++){var v=d+n.list.index;if(g){if((l=h?u.call(s,o[p[d]],p[d],t):u.call(s,o[d],v,t))!==f)return l}else if(u===o[h?p[d]:d])return p?p[d]:v}else for(d in o)if(g){if(r(o,d)&&(l=s?u.call(s,o[d],d,t):u(o[d],d,t))!==f)return l}else if(u===o[d])return d;return g?t.r:n.list.index?0:-1}}(),n.time={},n.time.is=function(t){return t?t instanceof Date:+new Date().getTime()},n.fn.is;var e=n.list.is,o=n.obj,i=o.is,r=o.has,a=o.map;t.exports=n})(t,"./type"),t(function(t){t.exports=function t(n,e,o){if(!n)return{to:t};var i,n=(this.tag||(this.tag={}))[n]||(this.tag[n]={tag:n,to:t._={next:function(t){var n;(n=this.to)&&n.next(t)}}});if("function"==typeof e){var r={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:e,the:n,on:this,as:o};return(r.back=n.last||n).to=r,n.last=r}return(n=n.to)&&i!==e&&n.next(e),n}})(t,"./onto"),t(function(t){var n="undefined"!=typeof setImmediate?setImmediate:setTimeout,e=function(t){if(o.length){o.push(t);return}o=[t],n(function t(e){e=e||+new Date;for(var i,r=0;r<9&&(i=o[r++]);)i();if(console.STAT&&console.STAT(e,+new Date-e,"puff"),i&&!(+new Date-e))return t(e);(o=o.slice(r)).length&&n(t,0)},0)},o=[];t.exports=setTimeout.puff=e})(t,"./puff"),t(function(t){if("undefined"==typeof JSON)throw Error("JSON is not included in this browser. Please load it first: ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js");var n=JSON.stringify;t.exports=function t(e,o,i,r,a){if(e<o)return{defer:!0};if(o<i)return{historical:!0};if(i<o)return{converge:!0,incoming:!0};if(o===i){if((r=n(r)||"")===(a=n(a)||""))return{state:!0};if(r<a)return{converge:!0,current:!0};if(a<r)return{converge:!0,incoming:!0}}return{err:"Invalid CRDT Data: "+r+" to "+a+" at "+o+" to "+i+"!"}}})(t,"./HAM"),t(function(n){var e=t("./type"),o={};o.is=function(t){return t!==i&&(null===t||t!==1/0&&!!(s(t)||a(t)||u(t)||o.link.is(t)))},o.link=o.rel={_:"#"},function(){o.link.is=function(n){if(n&&n[r]&&!n._&&c(n)){var e={};if(p(n,t,e),e.id)return e.id}return!1};function t(t,n){var e=this;return e.id?e.id=!1:n==r&&s(t)?void(e.id=t):e.id=!1}}(),o.link.ify=function(t){return l({},r,t)},e.obj.has._=".";var i,r=o.link._,a=e.bi.is,u=e.num.is,s=e.text.is,f=e.obj,c=f.is,l=f.put,p=f.map;n.exports=o})(t,"./val"),t(function(n){var e,o=t("./type"),i=t("./val"),r={_:"_"};r.soul=function(t,n){return t&&t._&&t._[n||l]},r.soul.ify=function(t,n){return n="string"==typeof n?{soul:n}:n||{},(t=t||{})._=t._||{},t._[l]=n.soul||t._[l]||c(),t},r.soul._=i.link._,function(){r.is=function(n,e,o){var i;return!!u(n)&&!!(i=r.soul(n))&&!f(n,t,{as:o,cb:e,s:i,n:n})};function t(t,n){if(n!==r._){if(!i.is(t))return!0;this.cb&&this.cb.call(this.as,t,n,this.n,this.s)}}}(),function(){r.ify=function(n,o,i){return o?"string"==typeof o?o={soul:o}:"function"==typeof o&&(o={map:o}):o={},o.map&&(o.node=o.map.call(i,n,e,o.node||{})),(o.node=r.soul.ify(o.node||{},o))&&f(n,t,{o:o,as:i}),o.node};function t(t,n){var e,o,r=this.o;if(r.map){o===(e=r.map.call(this.as,t,""+n,r.node))?s(r.node,n):r.node&&(r.node[n]=e);return}i.is(t)&&(r.node[n]=t)}}();var a=o.obj,u=a.is,s=a.del,f=a.map,c=o.text.random,l=r.soul._;n.exports=r})(t,"./node"),t(function(n){var e=t("./type"),o=t("./node");function i(){var t;return r<(t=+new Date)?(a=0,r=t+i.drift):r=t+(a+=1)/u+i.drift}e.time.is;var r=-1/0,a=0,u=1e3,s="undefined"!=typeof performance&&performance.timing&&performance;s&&s.timing&&s.timing.navigationStart||(s=!1);var f=i._=">";i.drift=0,i.is=function(t,n,e){var o=n&&t&&t[y]&&t[y][f]||e;if(o)return k(o=o[n])?o:-1/0},i.lex=function(){return i().toString(36).replace(".","")},i.ify=function(t,n,e,i,r){if(!t||!t[y]){if(!r)return;t=o.soul.ify(t,r)}var a=p(t[y],f);return c!==n&&n!==y&&(k(e)&&(a[n]=e),c!==i&&(t[n]=i)),t},i.to=function(t,n,e){var r=(t||{})[n];return d(r)&&(r=v(r)),i.ify(e,n,i.is(t,n),r,o.soul(t))},function(){i.map=function(n,e,o){var r,a=d(a=n||e)?a:null;return(n=m(n=n||e)?n:null,a&&!n)?(e=k(e)?e:i(),a[y]=a[y]||{},g(a,t,{o:a,s:e}),a):(o=o||d(e)?e:r,e=k(e)?e:i(),function(i,a,u,s){if(!n)return t.call({o:u,s:e},i,a),i;n.call(o||this||{},i,a,u,s),(!h(u,a)||r!==u[a])&&t.call({o:u,s:e},i,a)})};function t(t,n){y!==n&&i.ify(this.o,n,this.s)}}();var c,l=e.obj,p=l.as,h=l.has,d=l.is,g=l.map,v=l.copy,k=e.num.is,m=e.fn.is,y=o._;n.exports=i})(t,"./state"),t(function(n){var e,o=t("./type"),i=t("./val"),r=t("./node"),a={};(function(){function t(t,e){if(!t||e!==r.soul(t)||!r.is(t,this.fn,this.as))return!0;this.cb&&(n.n=t,n.as=this.as,this.cb.call(n.as,t,e,n))}function n(t){t&&r.is(n.n,t,n.as)}a.is=function(n,e,o,i){return!(!n||!s(n)||l(n))&&!h(n,t,{cb:e,fn:o,as:i})}})(),function(){function t(t,e){var o;return(o=function t(n,e){for(var o,i=n.seen,r=i.length;r--;)if(o=i[r],e.obj===o.obj)return o;i.push(e)}(t,e))?o:(e.env=t,e.soul=u,r.ify(e.obj,n,e)&&(e.link=e.link||i.link.ify(r.soul(e.node)),e.obj!==t.shell&&(t.graph[i.link.is(e.link)]=e.node)),e)}function n(n,o,a){var u,s,p=this,h=p.env;if(r._===o&&c(n,i.link._))return a._;if(u=l(n,o,a,p,h)){if(o||(p.node=p.node||a||{},c(n,r._)&&r.soul(n)&&(p.node._=d(n._)),p.node=r.soul.ify(p.node,i.link.is(p.link)),p.link=p.link||i.link.ify(r.soul(p.node))),(s=h.map)&&(s.call(h.as||{},n,o,a,p),c(a,o))){if(e===(n=a[o])){f(a,o);return}if(!(u=l(n,o,a,p,h)))return}return o?!0===u?n:(s=t(h,{obj:n,path:p.path.concat(o)})).node?s.link:void 0:p.node}}function u(t){var n=this,e=i.link.is(n.link),o=n.env.graph;n.link=n.link||i.link.ify(t),n.link[i.link._]=t,n.node&&n.node[r._]&&(n.node[r._][i.link._]=t),c(o,e)&&(o[t]=o[e],f(o,e))}function l(t,n,e,r,a){var u;return!!i.is(t)||(s(t)?1:(u=a.invalid)?l(t=u.call(a.as||{},t,n,e),n,e,r,a):void(a.err="Invalid value at '"+r.path.concat(n).join(".")+"'!",o.list.is(t)&&(a.err+=" Use `.set(item)` instead of an Array.")))}a.ify=function(n,o,r){var a={path:[],obj:n};return o?"string"==typeof o?o={soul:o}:"function"==typeof o&&(o.map=o):o={},"string"==typeof r&&(o.soul=o.soul||r,r=e),o.soul&&(a.link=i.link.ify(o.soul)),o.shell=(r||{}).shell,o.graph=o.graph||{},o.seen=o.seen||[],o.as=o.as||r,t(o,a),o.root=a.node,o.graph}}(),a.node=function(t){var n=r.soul(t);if(n)return p({},n,t)},function(){a.to=function(n,e,o){if(n){var i={};return o=o||{seen:{}},h(n[e],t,{obj:i,graph:n,opt:o}),i}};function t(t,n){var e,o;if(r._===n){if(l(t,i.link._))return;this.obj[n]=d(t);return}if(!(e=i.link.is(t))){this.obj[n]=t;return}if(o=this.opt.seen[e]){this.obj[n]=o;return}this.obj[n]=this.opt.seen[e]=a.to(this.graph,e,this.opt)}}(),o.fn.is;var u=o.obj,s=u.is,f=u.del,c=u.has,l=u.empty,p=u.put,h=u.map,d=u.copy;n.exports=a})(t,"./graph"),t(function(n){t("./onto"),n.exports=function t(n,e){if(this.on){if("function"!=typeof n){if(!n||!e)return;var o=n["#"]||n,i=(this.tag||"")[o];if(!i)return;return clearTimeout((i=this.on(o,e)).err),!0}var o=e&&e["#"]||Math.random().toString(36).slice(2);if(!n)return o;var r=this.on(o,n,e);return r.err=r.err||setTimeout(function(){r.next({err:"Error: No ACK yet.",lack:!0}),r.off()},(this.opt||{}).lack||9e3),o}}})(t,"./ask"),t(function(n){var e=t("./type");n.exports=function t(n){var o={s:{}},i=o.s;n=n||{max:1e3,age:27e3},o.check=function(t){return!!i[t]&&r(t)};var r=o.track=function(t){var e=i[t]||(i[t]={});return e.was=+new Date,o.to||(o.to=setTimeout(o.drop,n.age+9)),e};return o.drop=function(t){var r=+new Date;e.obj.map(i,function(e,o){(!e||!((t||n.age)>r-e.was))&&delete i[o]}),o.to=null,console.STAT&&(t=+new Date-r)>9&&console.STAT(r,t,"dup drop")},o}})(t,"./dup"),t(function(e){function o(t){return t instanceof o?(this._={$:this}).$:this instanceof o?o.create(this._={$:this,opt:t}):new o(t)}o.is=function(t){return t instanceof o||t&&t._&&t===t._.$||!1},o.version=.202,o.chain=o.prototype,o.chain.toJSON=function(){};var i,r=t("./type");r.obj.to(r,o),o.HAM=t("./HAM"),o.val=t("./val"),o.node=t("./node"),o.state=t("./state"),o.graph=t("./graph"),o.on=t("./onto"),o.ask=t("./ask"),o.dup=t("./dup"),o.puff=t("./puff"),function(){function t(e){if(e){if(e.out===t){this.to.next(e);return}var i,r=this.as,a=r.at||r,u=a.$,s=a.dup,c=e.DBG;if((i=e["#"])||(i=e["#"]=f(9)),!s.check(i)){if(s.track(i),i=e._,e._="function"==typeof i?i:function(){},e.$&&e.$===(e.$._||"").$||(e.$=u),!a.ask(e["@"],e)&&(c&&(c.u=+new Date),e.get&&o.on._get(e,u),e.put)){n(e);return}c&&(c.uc=+new Date),this.to.next(e),c&&(c.ua=+new Date),e.out=t,a.on("out",e),c&&(c.ue=+new Date)}}}function n(t){if(t){var n,i,s=t._||"",f=s.root=((s.$=t.$||"")._||"").root,c=t.put,l=t["#"],p=s.DBG=t.DBG;if(c["#"]&&c["."]){f.on("put",t);return}s.out=t,s.lot={s:0,more:1};var h=+new Date;for(var d in p&&(p.p=h),c){var v,k=c[d];if(!k){n=a+u(d)+"no node.";break}if(!(i=k._)){n=a+u(d)+"no meta.";break}if(d!==i[m]){n=a+u(d)+"soul not same.";break}if(!(v=i[x])){n=a+u(d)+"no state.";break}for(var y in k)if(b!==y){var w=k[y],j=v[y];if(g===j){n=a+u(y)+"on"+u(d)+"no state.";break}if(!$(w)){n=a+u(y)+"on"+u(d)+"bad "+typeof w+u(w);break}e(w,y,d,j,t)}if(n)break}if(p&&(p.pe=+new Date),console.STAT&&(console.STAT(h,+new Date-h,"mix"),console.STAT(h,s.lot.s,"mix #")),s.err=n){f.on("in",{"@":l,err:o.log(n)});return}--s.lot.more||r(s),s.stun||t["@"]||f.on("in",{"@":l,ok:-1})}}function e(t,n,o,i,r){var a,u=r._||"",f=u.root,p=f.graph[o]||w,h=k(p,n,1),d=p[n],g=l(),v=s(g,i,h,t,d);if(!v.incoming){if(v.defer){var m=i-g;return setTimeout(function(){e(t,n,o,i,r)},m>c?c:m),u.to||f.on("in",{"@":r["#"],err:m}),u.to=1,m}if(!u.miss)return}(a=u.lot||"").s++,a.more++,(u.stun||(u.stun={}))[o+n]=1;var y=u.DBG;y&&(y.ph=y.ph||+new Date),f.on("put",{"#":r["#"],"@":r["@"],put:{"#":o,".":n,":":t,">":i},_:u})}function i(t){(n=(t._||"").DBG)&&(n.pa=+new Date,n.pm=n.pm||+new Date);var n,e,o,i,a,u,s,f,c,l,p=this.as.graph,h=t._,d=t.put,k=d["#"],m=d["."],y=d[":"],b=d[">"];t["#"],p[k]=v(p[k],m,b,y,k),o=h,i=k,a=m,u=g!==(e=d["="])?e:y,s=b,((l=o.root).opt||"").super&&l.$.get(i),l&&(c=l.next)&&(c=c[i])&&c.$&&((f=o.put||(o.put={}))[i]=v(f[i],a,s,u,i),c.put=v(c.put,a,s,u,i)),(e=h.out)&&(e=e.put)&&(e[k]=v(e[k],m,b,y,k)),--h.lot.more||r(h),this.to.next(t)}function r(n){if(!n.err){var e,o={},i=((n.$||"")._||"").root,r=(i||"").next||"",a=n.put,u=+new Date;for(var s in a){var f=a[s];(e=r[s])&&e.$&&(i.stop=o,e.on("in",{$:e.$,get:s,put:f}),i.stop=null)}console.STAT&&console.STAT(u,+new Date-u,"fire"),n.DBG&&(n.DBG.f=+new Date),(e=n.out)&&(e.out=t,i.on("out",e))}}o.create=function(n){n.root=n.root||n,n.graph=n.graph||{},n.on=n.on||o.on,n.ask=n.ask||o.ask,n.dup=n.dup||o.dup();var e=n.$.opt(n.opt);return n.once||(n.on("in",t,n),n.on("out",t,n),n.on("put",i,n),o.on("create",n),n.on("create",n)),n.once=1,e},o.on.put=n;var a="Error: Invalid graph!",u=function(t){return" '"+(""+t).slice(0,9)+"...' "},s=o.HAM,c=2147483647,l=o.state}(),function(){function t(t,n,e,i){var r=this,a=o.state.is(e,n);if(!a)return r.err="Error: No state on '"+n+"' in node '"+i+"'!";var u=r.graph[i]||w,s=o.state.is(u,n,!0),f=u[n],c=o.HAM(r.machine,a,s,t,f);if(!c.incoming){c.defer&&(r.defer=a<(r.defer||1/0)?a:r.defer);return}r.put[i]=o.state.to(e,n,r.put[i]),(r.diff||(r.diff={}))[i]=o.state.to(e,n,r.diff[i]),r.souls[i]=!0}function n(t,n){var o=this,a=o.$._,u=(a.next||w)[n];if(!u){if(!(a.opt||w).super){o.souls[n]=!1;return}u=o.$.get(n)._}var s=o.map[n]={put:t,get:n,$:u.$};o.async=!!a.tag.node,o.ack&&(s["@"]=o.ack),d(t,e,{ctx:o,msg:s}),o.async&&(o.and||a.on("node",function(t){if(this.to.next(t),t===o.map[t.get])o.souls[t.get]=!1,d(t.put,i,t),!d(o.souls,function(t){if(t)return t})&&!o.c&&(o.c=1,this.off(),d(o.map,r,o))}),o.and=!0,a.on("node",s))}function e(t,n){var e=this.ctx,i=e.graph,r=this.msg,a=r.get,u=r.put,s=r.$._;i[a]=o.state.to(u,n,i[a]),!e.async&&(s.put=o.state.to(u,n,s.put))}function i(t,n){var e=this.put,i=this.$._;i.put=o.state.to(e,n,i.put)}function r(t,n){t.$&&(this.cat.stop=this.stop,t.$._.on("in",t),this.cat.stop=null)}function a(t,n){if(t!==this.graph[n])return!0}o.on._put=function(e,i){var u=i._,s={$:i,graph:u.graph,put:{},map:{},souls:{},machine:o.state(),ack:e["@"],cat:u,stop:{}};if(o.obj.map(e.put,a,s)){if(o.graph.is(e.put,null,t,s)||(s.err="Error: Invalid graph!"),s.err)return u.on("in",{"@":e["#"],err:o.log(s.err)});if(d(s.put,n,s),s.async||d(s.map,r,s),g!==s.defer){var f=s.defer-s.machine;setTimeout(function(){o.on._put(e,i)},f>MD?MD:f)}s.diff&&u.on("put",h(e,{put:s.diff}))}},o.on._get=function(t,n){var e,i=n._,r=t.get,a=r[m],u=i.graph[a],s=r[y],f=(i.next||(i.next={}))[a],c=(t._||"").DBG=t.DBG;if(c&&(c.g=+new Date),!u)return i.on("get",t);if(s){if("string"!=typeof s||!p(u,s))return i.on("get",t);u=o.state.to(u,s)}else u=o.window?o.obj.copy(u):u;u=o.graph.node(u),e=(f||w).ack;var l=function(){};l.ram=l.faith=!0,l.$=t.$,c&&(c.ga=+new Date),i.on("in",{"@":t["#"],put:u,ram:1,$:n,_:l}),c&&(c.gm=+new Date),i.on("get",t),c&&(c.gd=+new Date)}}(),o.chain.opt=function(t){t=t||{};var n=this._,e=t.peers||t;return l(t)||(t={}),l(n.opt)||(n.opt=t),s(e)&&(e=[e]),a(e)&&(e=d(e,function(t,n,e){(n={}).id=n.url=t,e(t,n)}),l(n.opt.peers)||(n.opt.peers={}),n.opt.peers=h(e,n.opt.peers)),n.opt.peers=n.opt.peers||{},d(t,function t(n,e){if(!p(this,e)||u.is(n)||c.empty(n)){this[e]=n;return}(!n||n.constructor===Object||a(n))&&d(n,t,this[e])},n.opt),o.on("opt",n),o.obj.native(),this},o.obj.native=function(){var t=Object.prototype;for(var n in t)console.log("Native Object.prototype polluted, reverting",n),delete t[n]};var a=o.list.is,u=o.text,s=u.is,f=u.random,c=o.obj,l=(c.empty,c.is),p=c.has,h=c.to,d=c.map;c.copy,o.state.lex;var g,v=o.state.ify,k=o.state.is,m=o.val.link._,y=".",b=o.node._,$=o.val.is,x=(o.val.link.is,o.state._),w={};o.log=function(){return o.log.off||i.log.apply(i,arguments),[].slice.call(arguments).join(" ")},o.log.once=function(t,n,e){return(e=o.log.once)[t]=e[t]||0,e[t]++||o.log(n)},"undefined"!=typeof window&&((window.GUN=window.Gun=o).window=window);try{void 0!==n&&(n.exports=o)}catch(j){}e.exports=o,(o.window||"").console=(o.window||"").console||{log:function(){}},(i=console).only=function(t,n){return i.only.i&&t===i.only.i&&i.only.i++&&(i.log.apply(i,arguments)||n)},o.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, please ask for help on http://chat.gun.eco if anything takes you longer than 5min to figure out!")})(t,"./root"),t(function(n){var e=t("./root");e.chain.back=function(t,n){if(-1===(t=t||1)||1/0===t)return this._.root.$;if(1===t)return(this._.back||this._).$;var r=this._;if("string"==typeof t&&(t=t.split(".")),t instanceof Array){for(var a=0,u=t.length,s=r;a<u;a++)s=(s||i)[t[a]];return o!==s?n?this:s:(s=r.back)?s.$.back(t,n):void 0}if("function"==typeof t){for(var s,f,s={back:r};(s=s.back)&&o===(f=t(s,n)););return f}return e.num.is(t)?(r.back||r).$.back(t-1):this};var o,i={}})(t,"./back"),t(function(n){var e=t("./root");function o(t){var n,o,i,r=this.as,a=r.back,u=r.root;if(t.$||(t.$=r.$),this.to.next(t),o=t.get){if(r.lex&&(t.get=v(r.lex,t.get)),o["#"]||r.soul){if(o["#"]=o["#"]||r.soul,t["#"]||(t["#"]=m(9)),a=u.$.get(o["#"])._,o=o["."]){if(d(a.put,o)){if((i=(n=a.$.get(o)._).ack)||(n.ack=-1),a.on("in",{$:a.$,put:e.state.to(a.put,o),get:a.get}),i)return}else if("string"!=typeof o){var n={},s=(a.put||{})._;if(e.obj.map(a.put,function(t,i){e.text.match(i,o)&&(n[i]=t)}),e.obj.empty(n)||(n._=s,a.on("in",{$:a.$,put:n,get:a.get})),i=r.lex){if(i=i._||(i._=function(){}),a.ack<i.ask&&(i.ask=a.ack),i.ask)return;i.ask=1}}}else{if((i=a.ack)||(a.ack=-1),d(a,"put")&&a.on("in",a),i&&l!==a.put)return;t.$=a.$}return u.ask(c,t),u.on("in",t)}if(u.now&&(u.now[r.id]=u.now[r.id]||!0,r.pass={}),o["."])return r.get?(t={get:{".":r.get},$:r.$},a.ask||(a.ask={}),a.ask[r.get]=t.$._,a.on("out",t)):(t={get:{},$:r.$},a.on("out",t));r.ack=r.ack||-1,r.get&&(t.$=r.$,o["."]=r.get,(a.ask||(a.ask={}))[r.get]=t.$._)}return a.on("out",t)}function i(t){var n,o,i=this.as,u=i.root,c=(t.$||p)._||p,h=t.put;if(i.get&&t.get!==i.get&&(t=v(t,{get:i.get})),i.has&&c!==i&&(t=v(t,{$:i.$}),c.ack&&(i.ack=c.ack)),l===h){if(o=c.put,this.to.next(t),i.soul||l===o&&l!==c.put)return;a(i,t,this),i.has&&f(i,t),g(c.echo,i.id),g(i.map,c.id);return}if(i.soul){this.to.next(t),a(i,t,this),i.next&&k(h,s,{msg:t,cat:i});return}if(!(n=e.val.link.is(h))){if(e.val.is(h)){i.has||i.soul?f(i,t):(c.has||c.soul)&&((c.echo||(c.echo={}))[i.id]=c.echo[c.id]||i,(i.map||(i.map={}))[c.id]=i.map[c.id]||{at:c}),this.to.next(t),a(i,t,this);return}i.has&&c!==i&&d(c,"put")&&(i.put=c.put),(n=e.node.soul(h))&&c.has&&(c.put=i.root.$.get(n)._.put),o=(u.stop||{})[c.id],this.to.next(t),r(i,t,c,n),a(i,t,this),i.next&&k(h,s,{msg:t,cat:i});return}u.stop,(o=(o=u.stop||{})[c.id]||(o[c.id]={})).is=o.is||c.put,o[i.id]=c.put||!0,this.to.next(t),r(i,t,c,n),a(i,t,this)}function r(t,n,o,i){if(i&&y!==t.get){var a,u,s,c,l=t.root.$.get(i)._;if(t.has?o=l:o.has&&r(o,n,o,i),o!==t){if(o.$||(o={}),(o.echo||(o.echo={}))[t.id]=o.echo[t.id]||t,t.has&&!(t.map||p)[o.id]&&f(t,n),i!==(l=o.id?(t.map||(t.map={}))[o.id]=t.map[o.id]||{at:o}:{}).link||l.pass||t.pass){t.pass&&(e.obj.map(t.map,function(t){t.pass=!0}),g(t,"pass")),l.pass&&g(l,"pass"),t.has&&(t.link=i),a=t,u=l.link=i,s=a.root.$.get(u)._,c=a.lex,(!a.ack&&!c||((c=c||{})["#"]=u,s.on("out",{get:c}),a.ask))&&(s=a.ask,e.obj.del(a,"ask"),k(s||a.next,function(t,n){var e=t.lex||{};e["#"]=u,e["."]=e["."]||n,t.on("out",{get:e})}),e.obj.del(a,"ask"))}}}}function a(t,n,e){t.echo&&k(t.echo,u,n)}function u(t){t&&t.on&&t.on("in",this)}function s(t,n){var o,i,r,a=this.cat.next||p,u=this.msg;(y!==n||a[n])&&(i=a[n])&&(i.has?(l!==i.put&&e.val.link.is(t)||(i.put=t),o=i.$):(r=u.$)&&(l===(r=(o=u.$.get(n))._).put||!e.val.link.is(t))&&(r.put=t),i.on("in",{put:t,get:n,$:o,via:u}))}function f(t,n){if(t.has||t.soul){var o=t.map;t.root,t.map=null,t.has&&(t.dub&&t.root.stop&&(t.dub=null),t.link=null),!(!t.pass&&!n["@"]&&null===o||l===o&&e.val.link.is(t.put))&&(k(o,function(n){(n=n.at)&&g(n.echo,t.id)}),o=t.put,k(t.next,function(n,e){if(l===o&&l!==t.put)return!0;n.put=l,n.ack&&(n.ack=-1),n.on("in",{get:e,$:n.$,put:l})}))}}function c(t,n){var o=this.as,i=o.get||"",r=o.$._,a=(t.put||"")[i["#"]];if(r.ack&&(r.ack=r.ack+1||1),!t.put||"string"==typeof i["."]&&!d(a,r.get)){if(r.put!==l)return;r.on("in",{get:r.get,put:r.put=l,$:r.$,"@":t["@"]});return}if(y==i["."]){r.on("in",{get:r.get,put:e.val.link.ify(i["#"]),$:r.$,"@":t["@"]});return}r.$===(t._||"").$&&(t._.miss=r.put===l),e.on.put(t)}e.chain.chain=function(t){var n,r=this._,a=new(t||this).constructor(this),u=a._;return u.root=n=r.root,u.id=++n.once,u.back=this._,u.on=e.on,u.on("in",i,u),u.on("out",o,u),a};var l,p={},h=e.obj,d=h.has,g=(h.put,h.del),v=h.to,k=h.map,m=e.text.random;e.val.link._;var y=e.node._})(t,"./chain"),t(function(n){var e=t("./root");function o(t){var n,o=this,i=o.as,r=i.at.root,u=(t.$||{})._||{},f=t.put||u.put;if((n=r.now)&&o!==n[i.now]||o.seen&&u.id&&o.seen[u.id])return o.to.next(t);if((n=f)&&n[s._]&&(n=s.is(n))&&c!==(n=(t.$$=u.root.$.get(n))._).put&&(t=a(t,{put:f=n.put})),(n=r.mum)&&u.id){var l=u.id+(o.id||(o.id=e.text.random(9)));if(n[l])return;c===f||s.is(f)||(n[l]=!0)}if(i.use(t,o),o.stun){o.stun=null;return}o.to.next(t)}function i(t){var n,e,o=this.on;if(!t||o.soul||o.has)return this.off();if(t=(t=(t=t.$||t)._||t).id){if(o.map,n=(e=this.seen||(this.seen={}))[t])return!0;e[t]=!0}}e.chain.get=function(t,n,a){if("string"==typeof t){if(0==t.length)return(a=this.chain())._.err={err:e.log("Invalid zero length string key!",t)},null;(j=(this._.next||l)[t])||(j=(p=t,h=this,d=h._,g=d.next,v=h.chain()._,g||(g=d.next={}),g[v.get=p]=v,h===d.root.$?v.soul=p:(d.soul||d.has)&&(v.has=p),v)),j=j.$}else if("function"==typeof t){if(!0===n){return k=this,m=t,y=n,b=a,x=k._,w=0,($=x.soul||x.link||x.dub)?m($,b,x):x.jam?x.jam.push([m,b]):(x.jam=[[m,b]],k.get(function t(n,e){if(!(c===n.put&&!x.root.opt.super&&($=Object.keys(x.root.opt.peers).length)&&++w<=$)){e.rid(n);var o,i=(i=n.$)&&i._||{},r=0;for($=x.jam,delete x.jam;o=$[r++];){var a,u=o[0];o=o[1],u&&u(a=i.link||i.soul||s.is(n.put)||f(n.put)||i.dub,o,n,e)}}},{out:{get:{".":!0}}}),k),this}j=this;var p,h,d,g,v,k,m,y,b,$,x,w,j,_,S,T=j._,A=T.root,_=A.now;(a=n||{}).at=T,a.use=t,a.out=a.out||{},a.out.get=a.out.get||{},(S=T.on("in",o,a)).rid=i,(A.now={$:1})[a.now=T.id]=S;var D=A.mum;return A.mum={},T.on("out",a.out),A.mum=D,A.now=_,j}else if(u(t))return this.get(""+t,n,a);else if(_=s.is(t))return this.get(_,n,a);else if(r.is(t))return j=this,(_=((_=t["#"])||l)["="]||_)&&(j=j.get(_)),j._.lex=t,j;else return(a=this.chain())._.err={err:e.log("Invalid get request!",t)},n&&n.call(a,a._.err),a;return(_=this._.stun)&&(j._.stun=j._.stun||_),n&&"function"==typeof n&&j.get(n,a),j};var r=e.obj,a=(r.map,r.has,e.obj.to),u=e.num.is,s=e.val.link,f=e.node.soul;e.node._;var c,l={}})(t,"./get"),t(function(n){var e=t("./root");function o(t){t&&t()}function i(){var t=this;t.graph&&d(t.stun)&&(t.res=t.res||function(t){t&&t()},t.res(function(){delete t.via._.stun;var n=t.$.back(-1)._,o=n.ask(function(o){n.root.on("ack",o),o.err&&e.log(o),++i>(t.acks||0)&&this.off(),t.ack&&t.ack(o,this)},t.opt),i=0,r=n.root.now;l.del(n.root,"now");var a=n.root.mum;n.root.mum={},t.ref._.on("out",{$:t.ref,put:t.out=t.env.graph,opt:t.opt,"#":o}),n.root.mum=a?l.to(a,n.root.mum):a,n.root.now=r,t.via._.on("res",{}),delete t.via._.tag.res},t),t.res&&t.res())}function r(t,n){if(t)return!0}function a(t,n,o,i){var r=this,a=e.is(t);!n&&i.path.length&&(r.res||k)(function(){var n=i.path,o=r.ref;r.opt;for(var s=0,f=n.length;s<f;s++)o=o.get(n[s]);a&&(o=t);var c=o._.dub;if(c||(c=e.node.soul(i.obj))){o.back(-1).get(c),i.soul(c);return}(r.stun=r.stun||{})[n]=1,o.get(u,!0,{as:{at:i,as:r,p:n,ref:o}})},{as:r,at:i})}function u(t,n,o,i){var r,n=n.as,a=(n.p,n.ref),u=n.at,f=[];n=n.as,a.back(function(t){if(r=t.soul||t.link||t.dub)return r;f.push(t.has||t.get)}),f=[r||n.soul].concat(f.reverse());var c=((o||{}).$||{})._||{};if(t=c.dub=c.dub||t||e.node.soul(u.obj)||e.node.soul(o.put||c.put)||e.val.link.is(o.put||c.put)||f.join("/"),i&&(i.stun=!0),!t){n.via.back("opt.uuid")(function(t,o){if(t)return e.log(t);s(c,c.dub=c.dub||o,u,n)});return}s(c,c.dub=t,u,n)}function s(t,n,e,o){t.$.back(-1).get(n),e.soul(n),delete o.stun[e.path],o.batch()}function f(t,n,o,i){if(n=n.as,o.$&&o.$._){if(o.err){e.log("Please report this as an issue! Put.any.err");return}var r,a=o.$._,u=a.put,s=n.opt||{};if(!(r=n.ref)||!r._.now){if(i&&(i.stun=!0),n.ref!==n.$){if(!(r=n.$._.get||a.get)){delete n.via._.stun,e.log("Please report this as an issue! Put.no.get");return}n.data=h({},r,n.data),r=null}if(c===u){if(!a.get){delete n.via._.stun;return}t||(r=a.$.back(function(t){if(t.link||t.soul)return t.link||t.soul;n.data=h({},t.get,n.data)}),n.not=!0),a=(r=r||a.soul||a.link||a.dub)?a.root.$.get(r)._:a,n.soul=r,u=n.data}if(!n.not&&!(n.soul=n.soul||t)&&(n.path&&p(n.data)?n.soul=(s.uuid||n.via.back("opt.uuid")||e.text.random)():(m==a.get&&(n.soul=(a.put||g)["#"]||a.dub),n.soul=n.soul||a.soul||a.link||(s.uuid||n.via.back("opt.uuid")||e.text.random)()),!n.soul)){n.via.back("opt.uuid")(function(t,o){if(t)return delete n.via._.stun,e.log(t);n.ref.put(n.data,n.soul=o,n)});return}n.ref.put(n.data,n.soul,n)}}}e.chain.put=function(t,n,r){var u,s=this,c=s._,l=c.root.$;return(l._,(r=r||{}).data=t,r.via=r.$=r.via||r.$||s,"string"==typeof n?r.soul=n:r.ack=r.ack||n,c.soul&&(r.soul=c.soul),r.soul||l===s)?p(r.data)?(r.soul=r.soul||(r.not=e.node.soul(r.data)||(r.via.back("opt.uuid")||e.text.random)()),r.via._.stun={},r.soul)?(r.$=l.get(r.soul),r.ref=r.$,function t(n){n.batch=i;var o=n.opt||{},r=n.env=e.state.map(a,o.state);if(r.soul=n.soul,n.graph=e.graph.ify(n.data,r,n),r.err){(n.ack||v).call(n,n.out={err:e.log(r.err)}),n.res&&n.res();return}n.batch()}(r),s):(r.via.back("opt.uuid")(function(t,n){if(t)return e.log(t);(r.ref||r.$).put(r.data,r.soul=n,r)}),s):((r.ack||v).call(r,r.out={err:e.log("Data saved to the root level of the graph must be a node (an object), not a",typeof r.data,'of "'+r.data+'"!')}),r.res&&r.res(),s):(r.via._.stun={},e.is(t))?(t.get(function(t,o,i){if(!t)return delete r.via._.stun,e.log("The reference you are saving is a",typeof i.put,'"'+i.put+'", not a node (object)!');s.put(e.val.link.ify(t),n,r)},!0),s):(c.has&&(u=e.val.link.is(t))&&(c.dub=u),r.ref=r.ref||l._===(u=c.back)?s:u.$,r.ref._.soul&&e.val.is(r.data)&&c.get)?(r.data=h({},c.get,r.data),r.ref.put(r.data,r.soul,r),s):(r.ref.get(f,!0,{as:r}),r.out||(r.res=r.res||o,r.$._.stun=r.ref._.stun),s)};var c,l=e.obj,p=l.is,h=l.put,d=(l.map,l.empty),g={},v=function(){},k=function(t,n){t.call(n||g)},m=e.node._})(t,"./put"),t(function(n){var e=t("./root");t("./chain"),t("./back"),t("./put"),t("./get"),n.exports=e})(t,"./index"),t(function(n){var e=t("./index");function o(t,n){var e,o=t.$,i=((o||{})._||{}).put||t.put;if(this.at,s!==i){if(e=t.$$){if(s===(e=t.$$._).put)return;i=e.put}this.change&&(i=t.put),this.as?this.ok.call(this.as,t,n):this.ok.call(o,i,t.get,t,n)}}function i(t,n,o){if(!t.$){n.off();return}var r,a,u=this.as,c=(u.at,t.$),l=c._,p=l.put||t.put;if((a=t.$$)&&s!==(r=a=t.$$._).put&&(p=r.put),(a=n.wait)&&(a=a[l.id])&&clearTimeout(a),n.ack=(n.ack||0)+1,o||s!==p||l.root.opt.super||!(n.ack<=(u.acks||Object.keys(l.root.opt.peers).length))){if(!o&&(s===p||l.soul||l.link||r&&!(0<r.ack))||s===p&&!l.root.opt.super&&(a=Object.keys(l.root.opt.peers).length)&&!o&&(r||l).ack<a){a=(n.wait={})[l.id]=setTimeout(function(){i.call({as:u},t,n,a||1)},u.wait||99);return}r&&s===r.put&&(a=f.is(p))&&(p=e.node.ify({},a)),n.rid?n.rid(t):n.off(),u.ok.call(c||u.$,p,t.get)}}e.chain.on=function(t,n,e,i){var r,a=this._;if("string"==typeof t)return n?(r=a.on(t,n,e||a,i),e&&e.$&&(e.subs||(e.subs=[])).push(r),this):a.on(t);var u=n;return(u=!0===u?{change:!0}:u||{}).at=a,u.ok=t,this.get(o,u),this},e.chain.val=function(t,n){return e.log.once("onceval","Future Breaking API Change: .val -> .once, apologies unexpected."),this.once(t,n)},e.chain.once=function(t,n){var o=this,r=o._,a=r.put;if(0<r.ack&&s!==a)return(t||c).call(o,a,r.get),o;if(t)(n=n||{}).ok=t,n.at=r,n.out={"#":e.text.random(9)},o.get(i,{as:n}),n.async=!0;else{e.log.once("valonce","Chainable val is experimental, its behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it.");var u=o.chain();return u._.nix=o.once(function(){u._.on("in",o._)}),u}return o},e.chain.off=function(){var t,n=this._,e=n.back;if(e)return n.ack=0,(t=e.next)&&t[n.get]&&u(t,n.get),(t=e.ask)&&u(t,n.get),(t=e.put)&&u(t,n.get),(t=n.soul)&&u(e.root.graph,t),(t=n.map)&&a(t,function(t){t.link&&e.root.$.get(t.link).off()}),(t=n.next)&&a(t,function(t){t.$.off()}),n.on("off",{}),this};var r=e.obj,a=r.map,u=(r.has,r.del);r.to;var s,f=e.val.link,c=function(){}})(t,"./on"),t(function(n){var e=t("./index");function o(t){if(!t.put||e.val.is(t.put))return this.to.next(t);this.as.nix&&this.off(),a(t.put,i,{at:this.as,msg:t}),this.to.next(t)}function i(t,n){if(s!==n){var o=this.msg.$,i=o._,r=this.at,a=i.lex;(!a||e.text.match(n,a["."]||a["#"]||a))&&(((a=o.get(n)._).echo||(a.echo={}))[r.id]=a.echo[r.id]||r)}}e.chain.map=function(t,n,i){var a,s=this._;return t?(e.log.once("mapfn","Map functions are experimental, their behavior and API may change moving forward. Please play with it and report bugs and ideas on how to improve it."),a=this.chain(),this.map().on(function(n,o,i,s){var f=(t||u).call(this,n,o,i,s);return r===f?void 0:n===f?a._.on("in",i):e.is(f)?a._.on("in",f._):void a._.on("in",{get:o,put:f})}),a):((a=s.each)||(s.each=a=this.chain(),a._.nix=this.back("nix"),this.on("in",o,a._)),a)};var r,a=e.obj.map,u=function(){},s=e.node._})(t,"./map"),t(function(n){var e=t("./index");function o(){return e.state.lex()+e.text.random(7)}e.chain.set=function(t,n,i){var r,a=this;return(n=n||function(){},(i=i||{}).item=i.item||t,(r=e.node.soul(t))&&(t=e.obj.put({},r,e.val.link.ify(r))),e.is(t))?(t.get(function(o,r,u){if(!o&&t._.stun){t._.on("res",function(){this.off(),a.set(t,n,i)});return}if(!o)return n.call(a,{err:e.log('Only a node can be linked! Not "'+u.put+'"!')});a.put(e.obj.put({},o,e.val.link.ify(o)),n,i)},!0),t):(e.obj.is(t)&&(r=r||e.node.soul(t)||o()),a.get(r||o()).put(t,n,i))}})(t,"./set"),t(function(t){if("undefined"!=typeof Gun){var n,e=function(){};try{n=(Gun.window||e).localStorage}catch(o){}n||(Gun.log("Warning: No localStorage exists to persist data to!"),n={setItem:function(t,n){this[t]=n},removeItem:function(t){delete this[t]},getItem:function(t){return this[t]}}),Gun.on("create",function(t){var e=this.to,o=t.opt;if(t.once||!1===o.localStorage)return e.next(t);o.prefix=o.file||"gun/";var i,r,a=Gun.obj.ify(n.getItem("gap/"+o.prefix))||{},u=Gun.obj.empty;if(!u(a)){var s=Gun.obj.ify(n.getItem(o.prefix))||{},f={};Gun.obj.map(a,function(t,n){Gun.obj.map(t,function(t,e){f[n]=Gun.state.to(s[n],e,f[n])})}),setTimeout(function(){t.on("out",{put:f,"#":t.ask(c)})},1)}function c(t){if(!t.err&&t.ok){var n=t["@"];setTimeout(function(){Gun.obj.map(a,function(t,e){Gun.obj.map(t,function(e,o){n===e&&delete t[o]}),u(t)&&delete a[e]}),p()},o.wait||1)}}t.on("out",function(t){!t.lS&&(Gun.is(t.$)&&t.put&&!t["@"]&&(i=t["#"],Gun.graph.is(t.put,null,l),r||(r=setTimeout(p,o.wait||1))),this.to.next(t))}),t.on("ack",c),e.next(t);var l=function(t,n,e,o){(a[o]||(a[o]={}))[n]=i},p=function(){clearTimeout(r),r=!1;try{n.setItem("gap/"+o.prefix,JSON.stringify(a))}catch(t){Gun.log(err=t||"localStorage failure")}}}),Gun.on("create",function(t){this.to.next(t);var e=t.opt;if(!t.once&&!1!==e.localStorage){e.prefix=e.file||"gun/",t.graph;var o,i={},r=0,a=Gun.obj.ify(n.getItem(e.prefix))||{};t.on("localStorage",a),t.on("put",function(t){this.to.next(t);var n,s=t.put,f=s["#"],c=s["."],l=s[":"],p=s[">"];if(a[f]=Gun.state.ify(a[f],c,p,l,f),t["@"]||((i[t["#"]]=n=(t._||"").lot||{}).lS=(n.lS||0)+1),(r+=1)>=(e.batch||1e3))return u();!o&&(o=setTimeout(u,e.wait||1))}),t.on("get",function(n){this.to.next(n);var e,o,i,r=n.get;function u(){if(r&&(e=r["#"])){var u=r["."];(o=a[e]||i)&&u&&(o=Gun.state.to(o,u)),t.on("in",{"@":n["#"],put:Gun.graph.node(o),lS:1})}}Gun.debug?setTimeout(u,1):u()});var u=function(s){r=0,clearTimeout(o),o=!1;var f,c=i;i={},s&&(a=s);try{n.setItem(e.prefix,JSON.stringify(a))}catch(l){Gun.log(f=(l||"localStorage failure")+" Consider using GUN's IndexedDB plugin for RAD for more storage space, https://gun.eco/docs/RAD#install"),t.on("localStorage:error",{err:f,file:e.prefix,flush:a,retry:u})}(f||Gun.obj.empty(e.peers))&&Gun.obj.map(c,function(n,e){if(n){if(n.more){i[e]=n;return}n.s!==n.lS&&(f="localStorage batch not same.")}t.on("in",{"@":e,err:f,ok:0})})}}})}})(t,"./adapters/localStorage"),t(function(n){var e=t("../type");function o(t){return t||{_:t._,"##":t["##"]}}!function(){var t,n=JSON.stringify;function o(t,n){if(!(n instanceof Object))return n;var o,r=+new Date;return e.obj.map(Object.keys(n).sort(),i,{to:o={},on:n}),console.STAT&&console.STAT(r,+new Date-r,"sort"),o}function i(t){this.to[t]=this.on[t]}e.obj.hash=function(i,r){if(r||t!==(i=n(i,o)))return e.text.hash(r||i||"")},e.obj.hash.sort=o}();var i=e.obj.is;e.obj.map;try{n.exports=function t(n){var o,r=function(){},a=n.opt||{};a.log=a.log||console.log,a.gap=a.gap||a.wait||0,a.pack=a.pack||(a.memory?1e6*a.memory:1399e6)*.3,a.puff=a.puff||9;var u=setTimeout.puff||setTimeout,s=n.dup,f=s.check,c=s.track,l=r.hear=function(t,o){if(t){if(a.pack<=t.length)return r.say({dam:"!",err:"Message too big!"},o);var s,h,d,g=t[0];if(r===this&&(l.d+=t.length||0,++l.c),"["===g){try{s=JSON.parse(t)}catch(v){a.log("DAM JSON parse error",v)}if(t="",!s)return;console.STAT&&console.STAT(+new Date,s.length,"# on hear batch");var k=a.puff;!function t(){for(var n,e=+new Date,i=0;i<k&&(n=s[i++]);)l(n,o);s=s.slice(i),console.STAT&&console.STAT(e,+new Date-e,"hear loop"),p(o),s.length&&u(t,0)}();return}if("{"===g||(t["#"]||i(t))&&(s=t)){try{s=s||JSON.parse(t)}catch(m){return a.log("DAM JSON parse error",m)}if(!s||(s.DBG&&(s.DBG=d={DBG:s.DBG}),d&&(d.hp=+new Date),(h=s["#"])||(h=s["#"]=e.text.random(9)),g=f(h)))return;if((s._=function(){}).via=r.leap=o,g=s.dam){(g=r.hear[g])&&g(s,o,n),c(h);return}var y,b=+new Date;d&&(d.is=b),n.on("in",s),d&&(d.hd=+new Date),console.STAT&&(y=+new Date-b)>9&&console.STAT(b,y,"msg"),c(h).via=o,r.leap=null}}};function p(t){var n=t.batch,e="string"==typeof n;if(e&&(n+="]"),t.batch=t.tail=null,n&&(e?!(3>n.length):!!n.length)){if(!e)try{n=1===n.length?n[0]:JSON.stringify(n)}catch(o){return a.log("DAM JSON stringify error",o)}n&&h(n,t)}}function h(t,n){try{var e=n.wire;n.say?n.say(t):e.send&&e.send(t),r.say.d+=t.length||0,++r.say.c}catch(o){(n.queue=n.queue||[]).push(t)}}l.c=l.d=0,function(){var t,n,o=0;function i(n){r.say(t,n)}var f=r.say=function(i,l){if((d=this)&&(d=d.to)&&d.next&&d.next(i),!i)return!1;var d,g,v,k,m=i.DBG;!l&&(k=+new Date,m&&(m.y=k));var y=i._||(i._=function(){});if((g=i["#"])||(g=i["#"]=e.text.random(9)),(v=y.raw)||(v=r.raw(i)),k&&console.STAT&&console.STAT(k,+new Date-k,"say prep"),n||c(g),!l&&(d=i["@"])&&(l=(d=s.s[d])&&(d.via||(d=d.it)&&(d=d._)&&d.via)||r.leap),!l&&i["@"])return console.STAT&&console.STAT(+new Date,++o,"total no peer to ack to"),!1;if(!l&&r.way)return r.way(i);if(!l||!l.id){if(t=i,!e.obj.is(l||a.peers))return!1;a.puff;var b=a.peers,$=Object.keys(l||a.peers||{});return void!function t(){var e=+new Date;n=1;var o=y.raw;y.raw=v;for(var r,a=0;a<9&&(r=($||"")[a++]);)(r=b[r])&&f(i,r);y.raw=o,n=0,$=$.slice(a),console.STAT&&console.STAT(e,+new Date-e,"say loop"),$.length&&(u(t,0),c(i["@"]))}()}if(!l.wire&&r.wire&&r.wire(l),g!==l.last){if(l.last=g,l===y.via||(d=y.to)&&(d[l.url]||d[l.pid]||d[l.id]))return!1;if(l.batch){if(l.tail=(d=l.tail||0)+v.length,l.tail<=a.pack){l.batch+=(d?",":"")+v;return}p(l)}l.batch="[";var x,k=+new Date;setTimeout(function(){console.STAT&&(x=+new Date-k)>9&&console.STAT(k,x,"0ms TO",g,l.id),p(l)},a.gap),h(v,l)}};r.say.c=r.say.d=0}(),r.raw=function(t){if(!t)return"";var n,e=t._||{};if(n=e.raw)return n;if("string"==typeof t)return t;var i=o(t);return e&&(i||"").length<1e5&&(e.raw=i),i},o=JSON.stringify,r.hi=function(t){var o=t.wire||{};t.id?a.peers[t.url||t.id]=t:(o=t.id=t.id||e.text.random(9),r.say({dam:"?",pid:n.opt.pid},a.peers[o]=t),delete s.s[t.last]),t.met=t.met||+new Date,o.hied||n.on(o.hied="hi",t),o=t.queue,t.queue=[],e.obj.map(o,function(n){h(n,t)}),e.obj.native&&e.obj.native()},r.bye=function(t){n.on("bye",t);var e=+new Date;e-=t.met||e,r.bye.time=((r.bye.time||e)+e)/2},r.hear["!"]=function(t,n){a.log("Error:",t.err)},r.hear["?"]=function(t,n){(!t.pid||(n.pid||(n.pid=t.pid),!t["@"]))&&(r.say({dam:"?",pid:a.pid,"@":t["#"]},n),delete s.s[n.last])},n.on("create",function(t){t.opt.pid=t.opt.pid||e.text.random(9),this.to.next(t),t.on("out",r.say)}),n.on("bye",function(t,n){t=a.peers[t.id||t]||t,this.to.next(t),t.bye?t.bye():(n=t.wire)&&n.close&&n.close(),e.obj.del(a.peers,t.id),t.wire=null});var d={};return n.on("bye",function(t,n){this.to.next(t),(n=t.url)&&(d[n]=!0,setTimeout(function(){delete d[n]},a.lack||9e3))}),n.on("hi",function(t,o){if(this.to.next(t),(o=t.url)&&d[o])delete d[o],!a.super&&e.obj.map(n.next,function(i,a){(o={})[a]=n.graph[a],r.say({"##":e.obj.hash(o),get:{"#":a}},t)})}),r}}catch(r){}})(t,"./adapters/mesh"),t(function(n){var e=t("../index");e.Mesh=t("./mesh"),e.on("opt",function(t){this.to.next(t);var n,o=t.opt;if(!t.once&&!1!==o.WebSocket){"undefined"!=typeof window&&(n=window),"undefined"!=typeof global&&(n=global),n=n||{};var i=o.WebSocket||n.WebSocket||n.webkitWebSocket||n.mozWebSocket;if(i){o.WebSocket=i;var r=o.mesh=o.mesh||e.Mesh(t);r.wire||o.wire,r.wire=o.wire=u,setTimeout(function(){t.on("out",{dam:"hi"})},1);var a="undefined"!=typeof document&&document}}function u(t){try{if(!t||!t.url)return e&&e(t);var n=t.url.replace(/^http/,"ws"),e=t.wire=new o.WebSocket(n);return e.onclose=function(){o.mesh.bye(t),s(t)},e.onerror=function(n){s(t)},e.onopen=function(){o.mesh.hi(t)},e.onmessage=function(n){n&&o.mesh.hear(n.data||n,t)},e}catch(i){}}function s(t){clearTimeout(t.defer),(!a||!(t.retry<=0))&&(t.retry=(t.retry||o.retry||60)-1,t.defer=setTimeout(function n(){if(a&&a.hidden)return setTimeout(n,2e3);u(t)},2e3))}})})(t,"./adapters/websocket")}();