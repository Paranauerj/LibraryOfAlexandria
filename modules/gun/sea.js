!function(){function t(e,r){return r?require(e):e.slice?t[n(e)]:function(r,a){e(r={exports:{}}),t[n(a)]=r.exports};function n(t){return t.split("/").slice(-1).toString().replace(".js","")}}if("undefined"!=typeof module)var e=module;t(function(t){"undefined"!=typeof window&&(t.window=window);var r=(t.window||t).SEA||{};(r.window=t.window)&&(r.window.SEA=r);try{void 0!==e&&(e.exports=r)}catch(n){}t.exports=r})(t,"./root"),t(function(e){var r=t("./root");try{r.window&&0>location.protocol.indexOf("s")&&0>location.host.indexOf("localhost")&&!/^127\.\d+\.\d+\.\d+$/.test(location.hostname)&&0>location.protocol.indexOf("file:")&&(console.warn("WebCrypto used by GUN SEA implementation does not work without HTTPS. Will automatically redirect."),location.protocol="https:")}catch(n){}})(t,"./https"),t(function(t){"undefined"==typeof btoa&&("undefined"==typeof Buffer&&(global.Buffer=require("buffer").Buffer),global.btoa=function(t){return Buffer.from(t,"binary").toString("base64")},global.atob=function(t){return Buffer.from(t,"base64").toString("binary")})})(t,"./base64"),t(function(e){function r(){}t("./base64"),Object.assign(r,{from:Array.from}),r.prototype=Object.create(Array.prototype),r.prototype.toString=function(t,e,r){t=t||"utf8",e=e||0;let n=this.length;if("hex"===t){let a=new Uint8Array(this);return[...Array((r&&r+1||n)-e).keys()].map(t=>a[t+e].toString(16).padStart(2,"0")).join("")}return"utf8"===t?Array.from({length:(r||n)-e},(t,r)=>String.fromCharCode(this[r+e])).join(""):"base64"===t?btoa(this):void 0},e.exports=r})(t,"./array"),t(function(e){t("./base64");var r=t("./array");function n(...t){return console.warn("new SafeBuffer() is depreciated, please use SafeBuffer.from()"),n.from(...t)}n.prototype=Object.create(Array.prototype),Object.assign(n,{from(){if(!Object.keys(arguments).length||null==arguments[0])throw TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.");let t=arguments[0],e;if("string"==typeof t){let n=arguments[1]||"utf8";if("hex"===n){let a=t.match(/([\da-fA-F]{2})/g).map(t=>parseInt(t,16));if(!a||!a.length)throw TypeError("Invalid first argument for type 'hex'.");e=r.from(a)}else if("utf8"===n){let i=t.length,o=new Uint16Array(i);Array.from({length:i},(e,r)=>o[r]=t.charCodeAt(r)),e=r.from(o)}else if("base64"===n){let u=atob(t),s=u.length,c=new Uint8Array(s);Array.from({length:s},(t,e)=>c[e]=u.charCodeAt(e)),e=r.from(c)}else"binary"===n?e=r.from(t):console.info("SafeBuffer.from unknown encoding: "+n);return e}t.byteLength;let f=t.byteLength?t.byteLength:t.length;if(f){let p;return t instanceof ArrayBuffer&&(p=new Uint8Array(t)),r.from(p||t)}},alloc:(t,e=0)=>r.from(new Uint8Array(Array.from({length:t},()=>e))),allocUnsafe:t=>r.from(new Uint8Array(Array.from({length:t}))),concat(t){if(!Array.isArray(t))throw TypeError("First argument must be Array containing ArrayBuffer or Uint8Array instances.");return r.from(t.reduce((t,e)=>t.concat(Array.from(e)),[]))}}),n.prototype.from=n.from,n.prototype.toString=r.prototype.toString,e.exports=n})(t,"./buffer"),t(function(e){let r=t("./root"),n=t("./buffer"),a={Buffer:n};var i={};if(r.window&&(a.crypto=window.crypto||window.msCrypto,a.subtle=(a.crypto||i).subtle||(a.crypto||i).webkitSubtle,a.TextEncoder=window.TextEncoder,a.TextDecoder=window.TextDecoder,a.random=t=>n.from(a.crypto.getRandomValues(new Uint8Array(n.alloc(t))))),!a.TextDecoder){let{TextEncoder:o,TextDecoder:u}=require("text-encoding");a.TextDecoder=u,a.TextEncoder=o}if(!a.crypto)try{var s=t("crypto",1);Object.assign(a,{crypto:s,random:t=>n.from(s.randomBytes(t))});let{Crypto:c}=t("@peculiar/webcrypto",1);a.ossl=a.subtle=new c({directory:"ossl"}).subtle}catch(f){console.log("text-encoding and @peculiar/webcrypto may not be included by default, please add it to your package.json!")}e.exports=a})(t,"./shim"),t(function(e){var r=t("./root");t("./buffer");var n={};n.pbkdf2={hash:{name:"SHA-256"},iter:1e5,ks:64},n.ecdsa={pair:{name:"ECDSA",namedCurve:"P-256"},sign:{name:"ECDSA",hash:{name:"SHA-256"}}},n.ecdh={name:"ECDH",namedCurve:"P-256"},n.jwk=function(t,e){var r,n={kty:"EC",crv:"P-256",x:(t=t.split("."))[0],y:t[1],ext:!0};return n.key_ops=e?["sign"]:["verify"],e&&(n.d=e),n},n.keyToJwk=function(t){let e=t.toString("base64"),r=e.replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"");return{kty:"oct",k:r,ext:!1,alg:"A256GCM"}},n.recall={validity:43200,hook:function(t){return t}},n.check=function(t){return"string"==typeof t&&"SEA{"===t.slice(0,4)},n.parse=function t(e){try{var r="string"==typeof e;return r&&"SEA{"===e.slice(0,4)&&(e=e.slice(3)),r?JSON.parse(e):e}catch(n){}return e},r.opt=n,e.exports=n})(t,"./settings"),t(function(e){var r=t("./shim");e.exports=async function(t,e){var n=await r.subtle.digest({name:e||"SHA-256"},new r.TextEncoder().encode("string"==typeof t?t:JSON.stringify(t)));return r.Buffer.from(n)}})(t,"./sha256"),t(function(e){let r=t("./shim"),n=r.subtle,a=r.ossl?r.ossl:n,i=t=>a.digest({name:"SHA-1"},new ArrayBuffer(t));e.exports=i})(t,"./sha1"),t(function(e){var r,n=t("./root"),a=t("./shim"),i=t("./settings"),o=t("./sha256");n.work=n.work||(async(t,e,u,s)=>{try{var c=(e||{}).epub||e;if(s=s||{},c instanceof Function&&(u=c,c=r),t="string"==typeof t?t:JSON.stringify(t),"sha"===(s.name||"").toLowerCase().slice(0,3)){var f=a.Buffer.from(await o(t,s.name),"binary").toString(s.encode||"base64");if(u)try{u(f)}catch(p){console.log(p)}return f}var l=await (a.ossl||a.subtle).deriveBits({name:s.name||"PBKDF2",iterations:s.iterations||i.pbkdf2.iter,salt:new a.TextEncoder().encode(s.salt||(c=c||a.random(9))),hash:s.hash||i.pbkdf2.hash},await (a.ossl||a.subtle).importKey("raw",new a.TextEncoder().encode(t),{name:s.name||"PBKDF2"},!1,["deriveBits"]),s.length||8*i.pbkdf2.ks);t=a.random(t.length);var y=a.Buffer.from(l,"binary").toString(s.encode||"base64");if(u)try{u(y)}catch(h){console.log(h)}return y}catch(g){if(console.log(g),n.err=g,n.throw)throw g;u&&u();return}}),e.exports=n.work})(t,"./work"),t(function(e){var r=t("./root"),n=t("./shim");t("./settings"),r.name=r.name||(async(t,e)=>{try{if(t)try{t()}catch(n){console.log(n)}return}catch(a){if(console.log(a),r.err=a,r.throw)throw a;t&&t();return}}),r.pair=r.pair||(async(t,e)=>{try{var a=n.ossl||n.subtle,i=await n.subtle.generateKey({name:"ECDSA",namedCurve:"P-256"},!0,["sign","verify"]).then(async t=>{var e={};e.priv=(await n.subtle.exportKey("jwk",t.privateKey)).d;var r=await n.subtle.exportKey("jwk",t.publicKey);return e.pub=r.x+"."+r.y,e});try{var o=await a.generateKey({name:"ECDH",namedCurve:"P-256"},!0,["deriveKey"]).then(async t=>{var e={};e.epriv=(await a.exportKey("jwk",t.privateKey)).d;var r=await a.exportKey("jwk",t.publicKey);return e.epub=r.x+"."+r.y,e})}catch(u){if(r.window)throw u;if("Error: ECDH is not a supported algorithm"==u)console.log("Ignoring ECDH...");else throw u}o=o||{};var s={pub:i.pub,priv:i.priv,epub:o.epub,epriv:o.epriv};if(t)try{t(s)}catch(c){console.log(c)}return s}catch(f){if(console.log(f),r.err=f,r.throw)throw f;t&&t();return}}),e.exports=r.pair})(t,"./pair"),t(function(e){var r,n=t("./root"),a=t("./shim"),i=t("./settings"),o=t("./sha256");n.sign=n.sign||(async(t,e,u,s)=>{try{if(s=s||{},(e||s).priv||(e=await n.I(null,{what:t,how:"sign",why:s.why})),r===t)throw"`undefined` not allowed.";var c=i.parse(t),f=s.check=s.check||c;if(n.verify&&(n.opt.check(f)||f&&f.s&&f.m)&&r!==await n.verify(f,e)){var p=i.parse(f);if(s.raw||(p="SEA"+JSON.stringify(p)),u)try{u(p)}catch(l){console.log(l)}return p}var y=e.pub,h=e.priv,g=i.jwk(y,h),d=await o(c),b=await (a.ossl||a.subtle).importKey("jwk",g,{name:"ECDSA",namedCurve:"P-256"},!1,["sign"]).then(t=>(a.ossl||a.subtle).sign({name:"ECDSA",hash:{name:"SHA-256"}},t,new Uint8Array(d))),p={m:c,s:a.Buffer.from(b,"binary").toString(s.encode||"base64")};if(s.raw||(p="SEA"+JSON.stringify(p)),u)try{u(p)}catch(w){console.log(w)}return p}catch(v){if(console.log(v),n.err=v,n.throw)throw v;u&&u();return}}),e.exports=n.sign})(t,"./sign"),t(function(e){var r,n=t("./root"),a=t("./shim"),i=t("./settings"),o=t("./sha256");n.verify=n.verify||(async(t,e,u,s)=>{try{var c,f,p,l=i.parse(t);if(!1===e){var y=i.parse(l.m);if(u)try{u(y)}catch(h){console.log(h)}return y}s=s||{};var g=e.pub||e,d=n.opt.slow_leak?await n.opt.slow_leak(g):await (a.ossl||a.subtle).importKey("jwk",i.jwk(g),{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),b=await o(l.m);try{if(!(p=await (a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},d,f=new Uint8Array(c=a.Buffer.from(l.s,s.encode||"base64")),new Uint8Array(b))))throw"Signature did not match."}catch(w){if(n.opt.fallback)return await n.opt.fall_verify(t,e,u,s)}var v=p?i.parse(l.m):r;if(u)try{u(v)}catch(m){console.log(m)}return v}catch(k){if(console.log(k),n.err=k,n.throw)throw k;u&&u();return}}),e.exports=n.verify;var u={};n.opt.slow_leak=t=>{if(u[t])return u[t];var e=i.jwk(t);return u[t]=(a.ossl||a.subtle).importKey("jwk",e,{name:"ECDSA",namedCurve:"P-256"},!1,["verify"]),u[t]};var s=n.opt;n.opt.fall_verify=async function(t,e,u,c,f){if(f===n.opt.fallback)throw"Signature did not match";f=f||1;var p,l,y,h=t||"";t=n.opt.unpack(t)||t;var g=i.parse(t),d=await n.opt.slow_leak(e.pub||e),b=f<=n.opt.fallback?a.Buffer.from(await a.subtle.digest({name:"SHA-256"},new a.TextEncoder().encode(i.parse(g.m)))):await o(g.m);try{if(!(y=await (a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},d,l=new Uint8Array(p=a.Buffer.from(g.s,c.encode||"base64")),new Uint8Array(b))))throw"Signature did not match."}catch(w){if(!(y=await (a.ossl||a.subtle).verify({name:"ECDSA",hash:{name:"SHA-256"}},d,l=new Uint8Array(p=a.Buffer.from(g.s,"utf8")),new Uint8Array(b))))throw"Signature did not match."}var v=y?i.parse(g.m):r;if(s.fall_soul=h["#"],s.fall_key=h["."],s.fall_val=t,s.fall_state=h[">"],u)try{u(v)}catch(m){console.log(m)}return v},n.opt.fallback=2})(t,"./verify"),t(function(e){var r=t("./shim"),n=t("./settings"),a=t("./sha256");let i=async(t,e,i)=>{i=i||{};let o=t+(e||r.random(8)).toString("utf8"),u=r.Buffer.from(await a(o),"binary"),s=n.keyToJwk(u);return await r.subtle.importKey("jwk",s,{name:"AES-GCM"},!1,["encrypt","decrypt"])};e.exports=i})(t,"./aeskey"),t(function(e){var r,n=t("./root"),a=t("./shim");t("./settings");var i=t("./aeskey");n.encrypt=n.encrypt||(async(t,e,o,u)=>{try{u=u||{};var s=(e||u).epriv||e;if(r===t)throw"`undefined` not allowed.";s||(s=(e=await n.I(null,{what:t,how:"encrypt",why:u.why})).epriv||e);var c="string"==typeof t?t:JSON.stringify(t),f={s:a.random(9),iv:a.random(15)},p=await i(s,f.s,u).then(t=>a.subtle.encrypt({name:u.name||"AES-GCM",iv:new Uint8Array(f.iv)},t,new a.TextEncoder().encode(c))),l={ct:a.Buffer.from(p,"binary").toString(u.encode||"base64"),iv:f.iv.toString(u.encode||"base64"),s:f.s.toString(u.encode||"base64")};if(u.raw||(l="SEA"+JSON.stringify(l)),o)try{o(l)}catch(y){console.log(y)}return l}catch(h){if(console.log(h),n.err=h,n.throw)throw h;o&&o();return}}),e.exports=n.encrypt})(t,"./encrypt"),t(function(e){var r=t("./root"),n=t("./shim"),a=t("./settings"),i=t("./aeskey");r.decrypt=r.decrypt||(async(t,e,o,u)=>{try{u=u||{};var s,c,f,p=(e||u).epriv||e;p||(p=(e=await r.I(null,{what:t,how:"decrypt",why:u.why})).epriv||e);var l=a.parse(t);try{s=n.Buffer.from(l.s,u.encode||"base64");var y=await i(p,s,u).then(t=>n.subtle.decrypt({name:u.name||"AES-GCM",iv:new Uint8Array(c=n.Buffer.from(l.iv,u.encode||"base64")),tagLength:128},t,new Uint8Array(f=n.Buffer.from(l.ct,u.encode||"base64"))))}catch(h){if("utf8"===u.encode)throw"Could not decrypt";if(r.opt.fallback)return u.encode="utf8",await r.decrypt(t,e,o,u)}var g=a.parse(new n.TextDecoder("utf8").decode(y));if(o)try{o(g)}catch(d){console.log(d)}return g}catch(b){if(console.log(b),r.err=b,r.throw)throw b;o&&o();return}}),e.exports=r.decrypt})(t,"./decrypt"),t(function(e){var r=t("./root"),n=t("./shim");t("./settings"),r.secret=r.secret||(async(t,e,i,o)=>{try{o=o||{},e&&e.epriv&&e.epub||(e=await r.I(null,{what:t,how:"secret",why:o.why}));var u=t.epub||t,s=e.epub,c=e.epriv,f=n.ossl||n.subtle,p=a(u),l=Object.assign({public:await f.importKey(...p,!0,[])},{name:"ECDH",namedCurve:"P-256"}),y=await f.importKey(...a(s,c),!1,["deriveBits"]).then(async t=>{var e,r=await f.importKey("raw",new Uint8Array(await f.deriveBits(l,t,256)),{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]);return f.exportKey("jwk",r).then(({k:t})=>t)});if(i)try{i(y)}catch(h){console.log(h)}return y}catch(g){if(console.log(g),r.err=g,r.throw)throw g;i&&i();return}});var a=(t,e)=>{var[r,n]=t.split(".");return["jwk",Object.assign(e?{d:e}:{},{x:r,y:n,kty:"EC",crv:"P-256",ext:!0}),{name:"ECDH",namedCurve:"P-256"}]};e.exports=r.secret})(t,"./secret"),t(function(e){var r=t("./root");r.certify=r.certify||(async(t,e={},n,a,i={})=>{try{if(console.log("SEA.certify() is an early experimental community supported method that may change API behavior without warning in any future version."),!(t=(()=>{var e=[];if(t){if(("string"==typeof t||Array.isArray(t))&&-1!==t.indexOf("*"))return"*";if("string"==typeof t)return t;if(Array.isArray(t)){if(1===t.length&&t[0])return"object"==typeof t[0]&&t[0].pub?t[0].pub:"string"==typeof t[0]?t[0]:null;t.map(t=>{"string"==typeof t?e.push(t):"object"==typeof t&&t.pub&&e.push(t.pub)})}return"object"==typeof t&&t.pub?t.pub:e.length>0?e:null}return null})()))return console.log("No certificant found.");let o=i.expiry&&("number"==typeof i.expiry||"string"==typeof i.expiry)?parseFloat(i.expiry):null,u=(e||{}).read?e.read:null,s=(e||{}).write?e.write:"string"==typeof e||Array.isArray(e)||e["+"]||e["#"]||e["."]||e["="]||e["*"]||e[">"]||e["<"]?e:null,c=((i||{}).blacklist||{}).read&&("string"==typeof i.blacklist.read||i.blacklist.read["#"])?i.blacklist.read:null,f="string"==typeof(i||{}).blacklist||(((i||{}).blacklist||{}).write||{})["#"]?i.blacklist:((i||{}).blacklist||{}).write&&("string"==typeof i.blacklist.write||i.blacklist.write["#"])?i.blacklist.write:null;if(!u&&!s)return console.log("No policy found.");let p=JSON.stringify({c:t,...o?{e:o}:{},...u?{r:u}:{},...s?{w:s}:{},...c?{rb:c}:{},...f?{wb:f}:{}}),l=await r.sign(p,n,null,{raw:1});var y=l;if(i.raw||(y="SEA"+JSON.stringify(y)),a)try{a(y)}catch(h){console.log(h)}return y}catch(g){if(r.err=g,r.throw)throw g;a&&a();return}}),e.exports=r.certify})(t,"./certify"),t(function(r){var n=t("./shim"),a=t("./root");a.work=t("./work"),a.sign=t("./sign"),a.verify=t("./verify"),a.encrypt=t("./encrypt"),a.decrypt=t("./decrypt"),a.certify=t("./certify"),a.random=a.random||n.random,a.Buffer=a.Buffer||t("./buffer"),a.keyid=a.keyid||(async t=>{try{let e=Buffer.concat(t.replace(/-/g,"+").replace(/_/g,"/").split(".").map(t=>Buffer.from(t,"base64"))),r=Buffer.concat([Buffer.from([153,e.length/256,e.length%256]),e]),n=await sha1hash(r),a=Buffer.from(n,"binary");return a.toString("hex",a.length-8)}catch(i){throw console.log(i),i}});var i=(a.window||{}).Gun||t((void 0===e?".":"")+"./gun",1);i.SEA=a,a.GUN=a.Gun=i,r.exports=a})(t,"./sea"),t(function(e){t("./sea").Gun.chain.then=function(t,e){var r=this,n=new Promise(function(t,n){r.once(t,e)});return t?n.then(t):n}})(t,"./then"),t(function(e){var r=t("./sea").Gun;function n(t){this._={$:this}}t("./then"),n.prototype=function(){function t(){}return t.prototype=r.chain,new t}(),n.prototype.constructor=n,r.chain.user=function(t){var e,a=this.back(-1);if(t)return a.get("~"+t);if(e=a.back("user"))return e;var a=a._,i=a,o=i.opt.uuid||r.state.lex;return(i=(e=i.user=this.chain(new n))._).opt={},i.opt.uuid=function(t){var e=o(),r=a.user;return r&&(r=r.is)&&(r=r.pub)&&(e=e+"~"+r+"/",t&&t.call&&t(null,e)),e},e},r.User=n,e.exports=n})(t,"./user"),t(function(e){var r=t("./sea"),n=t("./user");t("./settings");var a=r.Gun,i=function(){};n.prototype.create=function(...t){let e="object"==typeof t[0]&&(t[0].pub||t[0].epub)?t[0]:"object"==typeof t[1]&&(t[1].pub||t[1].epub)?t[1]:null,n=e&&(e.pub||e.epub)?e.pub:"string"==typeof t[0]?t[0]:null,o=e&&(e.pub||e.epub)?e:n&&"string"==typeof t[1]?t[1]:null,u=t.filter(t=>"function"==typeof t)[0]||null,s=t&&t.length>1&&"object"==typeof t[t.length-1]?t[t.length-1]:{};var c=this,f=c._,p=c.back(-1);if(f.ing)return(u||i)({err:a.log("User is already being created or authenticated!"),wait:!0}),c;f.ing=!0;var l={};return l.a=function(t){if(l.pubs=t,t&&!s.already){var e={err:a.log("User already created!")};f.ing=!1,(u||i)(e),c.leave();return}l.salt=a.text.random(64),r.work(o,l.salt,l.b)},l.b=function(t){l.proof=t,e?l.c(e):r.pair(l.c)},l.c=function(t){var e;l.pair=t||{},(e=f.root.user)&&(e._.sea=t,e.is={pub:t.pub,epub:t.epub,alias:n}),l.data={pub:t.pub},l.d()},l.d=function(){l.data.alias=n,l.e()},l.e=function(){l.data.epub=l.pair.epub,r.encrypt({priv:l.pair.priv,epriv:l.pair.epriv},l.proof,l.f,{raw:1})},l.f=function(t){l.data.auth=JSON.stringify({ek:t,s:l.salt}),l.g(l.data.auth)},l.g=function(t){var e;l.data.auth=l.data.auth||t,p.get(e="~"+l.pair.pub).put(l.data),p.get("~@"+n).put(a.obj.put({},e,a.val.link.ify(e)),l.h)},l.h=function(){f.ing=!1,(u||i)({ok:0,pub:l.pair.pub}),u||(e?c.auth(e):c.auth(n,o))},p.get("~@"+n).once(l.a),c},n.prototype.auth=function(...t){let e="object"==typeof t[0]&&(t[0].pub||t[0].epub)?t[0]:"object"==typeof t[1]&&(t[1].pub||t[1].epub)?t[1]:null,n=e||"string"!=typeof t[0]?null:t[0],o=n&&"string"==typeof t[1]?t[1]:null,u=t.filter(t=>"function"==typeof t)[0]||null,s=t&&t.length>1&&"object"==typeof t[t.length-1]?t[t.length-1]:{};var c=this,f=c._,p=c.back(-1);if(f.ing)return(u||i)({err:a.log("User is already being created or authenticated!"),wait:!0}),c;f.ing=!0;var l,y={};return y.a=function(t){if(!t)return y.b();if(!t.pub){var e=[];return a.node.is(t,function(t){e.push(t)}),y.b(e)}if(y.name)return y.f(t);y.c((y.data=t).auth)},y.b=function(t){var e=(y.list=(y.list||[]).concat(t||[])).shift();if(l===e)return y.name?y.err("Your user account is not published for dApps to access, please consider syncing it online, or allowing local access by adding your device as a peer."):y.err("Wrong user or password.");p.get(e).once(y.a)},y.c=function(t){return l===t?y.b():a.text.is(t)?y.c(a.obj.ify(t)):void r.work(o,(y.auth=t).s,y.d,y.enc)},y.d=function(t){r.decrypt(y.auth.ek,t,y.e,y.enc)},y.e=function(t){if(l===t)return y.enc?(y.enc=null,y.b()):(y.enc={encode:"utf8"},y.c(y.auth));y.half=t,y.f(y.data)},y.f=function(t){if(!t||!t.pub)return y.b();var e=y.half||{};y.g({pub:t.pub,epub:t.epub,priv:e.priv,epriv:e.epriv})},y.g=function(t){y.pair=t;var e=p._.user,l=e._;l.tag;var h=l.opt;(l=e._=p.get("~"+t.pub)._).opt=h,e.is={pub:t.pub,epub:t.epub,alias:n||t},l.sea=y.pair,f.ing=!1;try{o&&!a.obj.has(a.obj.ify(f.root.graph["~"+t.pub].auth),":")&&(s.shuffle=s.change=o)}catch(g){}if(s.change?y.z():(u||i)(l),r.window&&(c.back("user")._.opt||s).remember)try{var d={};(d=window.sessionStorage).recall=!0,d.pair=JSON.stringify(t)}catch(b){}try{p._.on("auth",l)}catch(w){a.log("Your 'auth' callback crashed with:",w)}},y.z=function(){y.salt=a.text.random(64),r.work(s.change,y.salt,y.y)},y.y=function(t){r.encrypt({priv:y.pair.priv,epriv:y.pair.epriv},t,y.x,{raw:1})},y.x=function(t){y.w(JSON.stringify({ek:t,s:y.salt}))},y.w=function(t){if(s.shuffle){console.log("migrate core account from UTF8 & shuffle");var e=a.obj.to(y.data);a.obj.del(e,"_"),e.auth=t,p.get("~"+y.pair.pub).put(e)}p.get("~"+y.pair.pub).get("auth").put(t,u||i)},y.err=function(t){var e={err:a.log(t||"User cannot be found!")};f.ing=!1,(u||i)(e)},y.plugin=function(t){if(!(y.name=t))return y.err();var e=[t];"~"!==t[0]&&(e[1]="~"+t,e[2]="~@"+t),y.b(e)},e?y.g(e):n?p.get("~@"+n).once(y.a):n||o||r.name(y.plugin),c},n.prototype.pair=function(){return console.log("user.pair() IS DEPRECATED AND WILL BE DELETED!!!"),!!this.is&&this._.sea},n.prototype.leave=function(t,e){var n=this.back(-1)._.user;if(n&&(delete n.is,delete n._.is,delete n._.sea),r.window)try{var a={};delete(a=window.sessionStorage).recall,delete a.pair}catch(i){}return this},n.prototype.delete=async function(t,e,r){console.log("user.delete() IS DEPRECATED AND WILL BE MOVED TO A MODULE!!!"),this.back(-1);var n=this.back("user");try{n.auth(t,e,function(t){(n.is||{}).pub,n.map().once(function(){this.put(null)}),n.leave(),(r||i)({ok:0})})}catch(o){a.log("User.delete failed! Error:",o)}return this},n.prototype.recall=function(t,e){var n=this,a=n.back(-1);if((t=t||{}).sessionStorage&&r.window)try{var i={};(i=window.sessionStorage)&&(a._.opt.remember=!0,(n.back("user")._.opt||t).remember=!0,(i.recall||i.pair)&&a.user().auth(JSON.parse(i.pair),e))}catch(o){}return n},n.prototype.alive=async function(){console.log("user.alive() IS DEPRECATED!!!");let t=this.back(-1);try{return await authRecall(t),t._.user._}catch(e){let r="No session!";throw a.log(r),{err:r}}},n.prototype.trust=async function(t){a.is(t)&&t.get("pub").get((t,e)=>{console.log(t,e)}),t.get("trust").get(path).put(theirPubkey)},n.prototype.grant=function(t,e){console.log("`.grant` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var n=this.back(-1).user(),a=n._.sea,i="";return this.back(function(t){!t.is&&(i+=t.get||"")}),async function(){var o,u=await n.get("grant").get(a.pub).get(i).then();(u=await r.decrypt(u,a))||(o=await r.encrypt(u=r.random(16).toString(),a),n.get("grant").get(a.pub).get(i).put(o));var s=t.get("pub").then(),c=t.get("epub").then();s=await s,o=await r.encrypt(u,await r.secret(c=await c,a)),n.get("grant").get(s).get(i).put(o,e)}(),this},n.prototype.secret=function(t,e){console.log("`.secret` API MAY BE DELETED OR CHANGED OR RENAMED, DO NOT USE!");var n=this,a=n.back(-1).user(),i=a.pair(),o="";return n.back(function(t){!t.is&&(o+=t.get||"")}),async function(){var u,s=await a.get("trust").get(i.pub).get(o).then();(s=await r.decrypt(s,i))||(u=await r.encrypt(s=r.random(16).toString(),i),a.get("trust").get(i.pub).get(o).put(u)),u=await r.encrypt(t,s),n.put(u,e)}(),n},e.exports=n})(t,"./create"),t(function(e){var r=t("./sea"),n=t("./settings"),a=r.Gun;function i(t){var e,n=this.to,i=(t.$._.put,0);a.node.is(t.put,function(o,u,s){var c=a.obj.ify(o)||y;if(l!==c[":"]){s[u]=r.opt.unpack(c);return}r.opt.check(o)&&(i++,r.verify(o,!1,function(a){i--,s[u]=r.opt.unpack(a,u,s),e&&!i&&(i=-1)&&n.next(t)}))}),e=!0,i||n.next(t)}function o(t){if((t._||y).user)return this.to.next(t);var e=this.as;(t._||(t._=function(){})).user=e.user,c.call(this,t)}function u(t){var e,n=this,i=n.as,o=t.put,s=o["#"],c=o["."],f=o[":"],p=o[">"],l=t["#"];if(s&&c){if((t._||"").faith&&(i.opt||"").faith&&"function"==typeof t._){r.verify(r.opt.pack(o),!1,function(e){o["="]=r.opt.unpack(e),n.to.next(t)});return}var y=function(t){i.on("in",{"@":l,err:t})};if((t._||"").DBG&&((t._||"").DBG.c=+new Date),0<=s.indexOf("<?")&&(e=parseFloat(s.split("<?")[1]||""))&&p<a.state()-1e3*e){(e=t._)&&(e=e.lot)&&e.more--;return}if("~@"===s){u.alias(n,t,f,c,s,i,y);return}if("~@"===s.slice(0,2)){u.pubs(n,t,f,c,s,i,y);return}if(e=r.opt.pub(s)){u.pub(n,t,f,c,s,i,y,i.user||"",e);return}if(0<=s.indexOf("#")){u.hash(n,t,f,c,s,i,y);return}u.any(n,t,f,c,s,i,y,i.user||"")}}a.on("opt",function(t){t.sea||(t.sea={own:{}},t.on("put",u,t)),this.to.next(t)}),u.hash=function(t,e,n,a,i,o,u){r.work(n,null,function(r){if(r&&r===a.split("#").slice(-1)[0])return t.to.next(e);u("Data hash not same as hash!")},{name:"SHA-256"})},u.alias=function(t,e,r,n,a,i,o){return r?"~@"+n===s(r)?t.to.next(e):void o("Alias not same!"):o("Data must exist!")},u.pubs=function(t,e,r,n,a,i,o){return r?n===s(r)?t.to.next(e):void o("Alias not same!"):o("Alias must exist!")},u.pub=function(t,e,i,o,u,c,f,p,y){var h;let g=n.parse(i)||{},d=(t,n,i)=>{if(t.m&&t.s&&n&&y)return r.verify(t,y,t=>{if(l!==t&&l!==t.e&&e.put[">"]&&e.put[">"]>parseFloat(t.e))return f("Certificate expired.");if(l!==t&&t.c&&t.w&&(t.c===n||t.c.indexOf("*")>-1)){let r=u.indexOf("/")>-1?u.replace(u.substring(0,u.indexOf("/")+1),""):"";String.match=String.match||a.text.match;let s=Array.isArray(t.w)?t.w:"object"==typeof t.w||"string"==typeof t.w?[t.w]:[];for(let p of s)if(String.match(r,p["#"])&&String.match(o,p["."])||!p["."]&&String.match(r,p["#"])||!p["#"]&&String.match(o,p["."])||String.match(r?r+"/"+o:o,p["#"]||p)){if(p["+"]&&p["+"].indexOf("*")>-1&&r&&-1==r.indexOf(n)&&-1==o.indexOf(n))return f(`Path "${r}" or key "${o}" must contain string "${n}".`);if(t.wb&&("string"==typeof t.wb||(t.wb||{})["#"])){var h=c.$.back(-1);return"string"==typeof t.wb&&"~"!==t.wb.slice(0,1)&&(h=h.get("~"+y)),h.get(t.wb).get(n).once(e=>e&&(1===e||!0===e)?f("Certificant blacklisted."):i(t))}return i(t)}return f("Certificate verification fail.")}})};if("pub"===o&&"~"+y===u)return i===y?t.to.next(e):f("Account not same!");if((h=p.is)&&h.pub&&!g["*"]&&!g["+"]&&(y===h.pub||y!==h.pub&&((e._.out||{}).opt||{}).cert)){r.sign(r.opt.pack(e.put),p._.sea,function(a){if(l===a)return f(r.err||"Signature fail.");if(e.put[":"]={":":h=r.opt.unpack(a.m),"~":a.s},e.put["="]=h,y===p.is.pub)return(h=s(i))&&((c.sea.own[h]=c.sea.own[h]||{})[y]=1),e.put[":"]=JSON.stringify(e.put[":"]),t.to.next(e);if(y!==p.is.pub&&((e._.out||{}).opt||{}).cert){let o=n.parse(e._.out.opt.cert);o&&o.m&&o.s&&d(o,p.is.pub,r=>(e.put[":"]["+"]=o,e.put[":"]["*"]=p.is.pub,e.put[":"]=JSON.stringify(e.put[":"]),t.to.next(e)))}},{raw:1});return}r.verify(r.opt.pack(e.put),g["*"]||y,function(n){var a;return l===(n=r.opt.unpack(n))?f("Unverified data."):((a=s(n))&&y===r.opt.pub(a)&&((c.sea.own[a]=c.sea.own[a]||{})[y]=1),g["+"]&&g["+"].m&&g["+"].s&&g["*"])?void d(g["+"],g["*"],r=>(e.put["="]=n,t.to.next(e))):(e.put["="]=n,t.to.next(e))})},u.any=function(t,e,r,n,a,i,o,u){if(i.opt.secure)return o("Soul missing public key at '"+n+"'.");i.on("secure",function(e){if(this.off(),!i.opt.secure)return t.to.next(e);o("Data cannot be changed.")}).on.on("secure",e)};var s=a.val.link.is;function c(t){var e=this.as,n=(e.sea,this.to);if(e.opt.faith&&(t._||y).faith){this.to.next(t);return}if(t.get){var i=t.get["#"];if(i)return"string"!=typeof i||"alias"===i||i.slice(0,2),n.next(t)}if(t.put){var o,u={},s={};s.node=function(t,e){if(a.obj.empty(t,"_"))return u["node"+e]=0;a.obj.map(t,s.way,{soul:e,node:t})},s.way=function(e,r){var n,a=this.soul,i=this.node;if("_"!==r){if("~@"===a){s.alias(e,r,i,a);return}if("~@"===a.slice(0,2)){s.pubs(e,r,i,a);return}if("~"===a.slice(0,1)&&2===(n=a.slice(1)).split(".").length){s.pub(e,r,i,a,n,(t._||y).user);return}s.any(e,r,i,a,(t._||y).user)}},s.alias=function(t,e,r,n){return t?"~@"+e===a.val.link.is(t)?u["alias"+e]=0:void s.end({err:"Mismatching alias."}):s.end({err:"Data must exist!"})},s.pubs=function(t,e,r,n){return t?e===a.val.link.is(t)?u["pubs"+n+e]=0:void s.end({err:"Alias must match!"}):s.end({err:"Alias must exist!"})},s.pub=function(n,i,c,f,p,l){var y;if("pub"===i)return n===p?u["pub"+f+i]=0:s.end({err:"Account must match!"});if(u["user"+f+i]=1,a.is(t.$)&&l&&l.is&&p===l.is.pub){r.sign(r.opt.prep(y=r.opt.parse(n),i,c,f),l._.sea,function(t){var l;if(o===t)return s.end({err:r.err||"Pub signature fail."});(l=a.val.link.is(n))&&((e.sea.own[l]=e.sea.own[l]||{})[p]=!0),c[i]=JSON.stringify({":":r.opt.unpack(t.m),"~":t.s}),u["user"+f+i]=0,s.end({ok:1})},{check:r.opt.pack(y,i,c,f),raw:1});return}r.verify(r.opt.pack(n,i,c,f),p,function(t){var n;if(o===(t=r.opt.unpack(t,i,c)))return s.end({err:"Unverified data."});(n=a.val.link.is(t))&&p===r.opt.pub(n)&&((e.sea.own[n]=e.sea.own[n]||{})[p]=!0),u["user"+f+i]=0,s.end({ok:1})})},s.any=function(n,i,c,f,p){var l,y;if(!(y=r.opt.pub(f))){if(e.opt.secure){s.end({err:"Soul is missing public key at '"+i+"'."});return}u["any"+f+i]=1,e.on("secure",function(t){this.off(),u["any"+f+i]=0,e.opt.secure&&(t=null),s.end(t||{err:"Data cannot be modified."})}).on.on("secure",t);return}if(a.is(t.$)&&p&&p.is&&y===p.is.pub){u["any"+f+i]=1,r.sign(r.opt.prep(l=r.opt.parse(n),i,c,f),p._.sea,function(t){if(o===t)return s.end({err:"My signature fail."});c[i]=JSON.stringify({":":r.opt.unpack(t.m),"~":t.s}),u["any"+f+i]=0,s.end({ok:1})},{check:r.opt.pack(l,i,c,f),raw:1});return}u["any"+f+i]=1,r.verify(r.opt.pack(n,i,c,f),y,function(t){var n;if(o===(t=r.opt.unpack(t,i,c)))return s.end({err:"Mismatched owner on '"+i+"'."});(n=a.val.link.is(t))&&y===r.opt.pub(n)&&((e.sea.own[n]=e.sea.own[n]||{})[y]=!0),u["any"+f+i]=0,s.end({ok:1})})},s.end=function(r){if(!s.err){if((s.err=r.err)||r.no){console.log("NO!",s.err,t.put);return}!(!s.end.ed||a.obj.map(u,function(t){if(t)return!0}))&&((t._||{}).user=e.user||c,n.next(t))}},a.obj.map(t.put,s.node),s.end({end:s.end.ed=!0});return}n.next(t)}a.state.ify;var f=/[^\w_-]/;r.opt.pub=function(t){if(t&&(t=t.split("~"))&&(t=t[1])&&(t=t.split(f).slice(0,2))&&2==t.length&&"@"!==(t[0]||"")[0])return t=t.slice(0,2).join(".")},r.opt.prep=function(t,e,n,i){return{"#":i,".":e,":":r.opt.parse(t),">":a.state.is(n,e)}},r.opt.pack=function(t,e,n,i){if(r.opt.check(t))return t;var o=a.obj.ify(t&&t[":"]||t)||"",u=o["~"];return u?{m:{"#":i||t["#"],".":e||t["."],":":o[":"],">":t[">"]||a.state.is(n,e)},s:u}:t};var p=r.opt;r.opt.unpack=function(t,e,n){if(l!==t){if(t&&l!==(i=t[":"]))return i;if(e=e||p.fall_key,!n&&p.fall_val&&((n={})[e]=p.fall_val),e&&n){if(t===n[e]||!r.opt.check(n[e]))return t;var i,o=a.node.soul(n)||p.fall_soul,u=a.state.is(n,e)||p.fall_state;return t&&4===t.length&&o===t[0]&&e===t[1]&&h(u)===h(t[3])?t[2]:u<r.opt.shuffle_attack?t:void 0}}},r.opt.shuffle_attack=15463296e5;var l,y=function(){},h=Math.floor;a.val.rel.is,a.obj.ify})(t,"./index")}();